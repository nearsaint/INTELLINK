<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="zh-CN">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" name="viewport" id="viewport" />
  <!-- 上述3个meta标签*必须*放在最前面 -->
  <meta name="renderer" content="webkit">
  <meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
  <title>camera</title>
  <script language="javascript" src="md5.js"></script>
  <script>
    function autologin() {
      InitPage();
      DoLogin();
    }

    //工具函数---start
    function CreateEmptyString(l) {
      var a = [];
      for (var i = 0; i < l; i++) {
        a[i] = '*';
      }
      return a.join('');
    }


    //向列表中添加表项
    function AddList(sel, text, value) {
      var option = document.createElement("option");
      option.appendChild(document.createTextNode(text));
      option.setAttribute("value", value);
      sel.appendChild(option);
      return;
    }


    //去除时间格式内的HTTP关键字
    function FormatTime(time) {
      var tmp_string = time.split(' ');
      var tmp_string_cp = tmp_string[1].split(':');
      return tmp_string[0] + '%20' + tmp_string_cp[0] + '%3A' + tmp_string_cp[1] + '%3A' + tmp_string_cp[2];
    }



    var IS_SHOW_DEBUG = 0; //0-关闭, 1-开启
    var gdownloadID = 1; //下载编码
    var gdownloadID2 = 1;

    function DebugAlert(str) {
      if (IS_SHOW_DEBUG == 1) {
        alert(str);
      }
    }

    String.prototype.replaceAll = function(f, r) {
      var s = new String(this);
      while (s.indexOf(f) != -1) {
        s = s.replace(f, r);
      }
      return s.toString();
    }

    /**
     * 解析从控件返回的xml字符串
     */
    function loadXML(xmlString) {
      if (!g_xmlActive) {
        return;
      }
      g_xmlActive.loadXML(xmlString);
      if (0 == g_xmlActive.parseError.errorCode) {
        return g_xmlActive;
      } else {
        alert("xml解析错误:" + g_xmlActive.parseError.reason);
        return null;
      }
    }

    function getElementById(dom, tagName) {
      for (var i = 0; i < dom.childNodes.length; i++) {
        var node = dom.childNodes[i];
        if (node.baseName == tagName) {
          return node.nodeTypedValue;
        } else {
          if (node.childNodes.length != 0) {
            getElementById(dom.childNodes[i], tagName);
          }
        }
      }
    }

    //工具函数---end



    //全局变量---start

    var g_UserLoginId = '';
    var g_imosActivePlayer = null;
    var g_curFrameNum = '';
    var g_xmlActive = null;
    var g_isLogin = 1;
    var initPage_done = false;


    //全局变量---end



    //================>功能函数---start
    //检查控件
    function InitPage() {

      g_imosActivePlayer = document.all.h3c_IMOS_ActiveX;
      g_PlayFrame = document.all.Play_Frame;
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
      }

      var xmldoc;
      try {
        xmldoc = new ActiveXObject("Microsoft.XMLDOM");
        if (!xmldoc) {
          xmldoc = new ActiveXObject("MSXML2.DOMDocument.3.0");
        }
      } catch (e) {
        console.log(e);
      }
      g_xmlActive = xmldoc;
      if (!g_xmlActive) {
        alert("xml解析器获取错误，将导致某些功能不可用");
      } else {
        g_xmlActive.async = "false";
        console.log("page inited");
        initPage_done = true;
      }
    }

    //登录
    function DoLogin() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var serverIP = document.getElementById("ServerIPText").value;
      var userName = document.getElementById("UserNameText").value;
      var passWd = document.getElementById("PassWordText").value.toString();
      if (passWd == "") {
        passWd = "";
      }

      g_isLogin = g_imosActivePlayer.IMOSAX_InitOCX(serverIP, "8800", userName, passWd, 1);
      if (0 != g_isLogin) {
        alert("IMOSAX_InitOCX Error:" + g_isLogin);
        return;
      }

      //获取用户信息
      var retStr = g_imosActivePlayer.IMOSAX_GetUserLoginInfo();
      var userObj = loadXML(retStr);
      g_UserLoginId = userObj.documentElement.selectNodes("//LOGININFO/UserLoginIDInfo/UserLoginCode")[0].text;

      var loginSt = document.getElementById("loginSt");
      loginSt.innerText = "系统登录成功！用户名：" + userName;

    }


    //退出登录
    function DoLogout() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }

      var flag = g_imosActivePlayer.IMOSAX_UnregOCX();
      if (0 != flag) {
        alert("IMOSAX_UnregOCX Error:" + flag);
        return;
      }

      var loginSt = document.getElementById("loginSt");
      loginSt.innerText = "系统未登录！";
    }

    //软解业务
    //启动软解轮切
    function DoStartSwitch() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var switchID = document.getElementById("SwitchIDText").value;
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StartFrameSwitch(frameNum, switchID);
      if (0 == flag) {
        alert("启动轮切成功");
      } else {
        alert("启动轮切失败，错误码：" + flag);
      }
    }

    //停止软解轮切
    function DoStopSwitch() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var frameNum = g_curFrameNum;
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StopFrameSwitch(frameNum);
      if (0 == flag) {
        alert("停止轮切成功");
      } else {
        alert("停止轮切失败，错误码：" + flag);
      }
    }
    //软解轮切控制
    function DoAdjustFrameSwitch() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var frameNum = g_curFrameNum;
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请选择一个窗格");
        return;
      }
      var adjustAction = document.getElementById("AdjustAction").value;
      var flag = g_imosActivePlayer.IMOSAX_AdjustFrameSwitch(frameNum, adjustAction);
      if (0 == flag) {
        alert("轮切控制成功");
      } else {
        alert("轮切控制失败，错误码：" + flag);
      }
    }
    //绑定窗格通道
    function DoSetPlayWnd() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var frameNum = g_curFrameNum;
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请选择一个窗格");
        return;
      }
      var frameHWnd = document.getElementById("FrameHWnd").value;
      var flag = g_imosActivePlayer.IMOSAX_SetPlayWnd(frameNum, frameHWnd);
      if (0 == flag) {
        alert("绑定窗格通道成功");
      } else {
        alert("绑定失败，错误码：" + flag);
      }

    }

    function DoSetAlarmInfo() {
      //alert("DoSetAlarmInfo");
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }

      //告警类型、开始小时、开始分钟、结束小时、结束分钟、闪烁时长
      var flag = g_imosActivePlayer.IMOSAX_SetAlarmInfo(401, 13, 55, 10, 54, 7);
      if (0 == flag) {
        alert("设置告警成功");
      } else {
        alert("设置告警失败，错误码：" + flag);
      }
    }

    //启动软解实况
    function DoStartPlay() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var cameraId = document.getElementById("CamIDText").value;
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StartFrameLive(frameNum, cameraId);
      if (0 == flag) {
        alert("实况播放成功");
      } else {
        alert("播放实况失败，错误码：" + flag);
      }
    }

    //释放软解实况
    function DoStopPlay() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var frameNum = g_curFrameNum;
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StopFramelive(frameNum);
      if (0 == flag) {
        alert("停止实况成功");
      } else {
        alert("停止实况失败，错误码：" + flag);
      }
    }
    //硬解业务
    //启动硬解实况
    function DoStartMonitorLive() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var cameraId = document.getElementById("CamIDText").value;
      var monitorId = document.getElementById("MonitorIDText").value;
      var flag = g_imosActivePlayer.IMOSAX_StartMonitorLive(monitorId, cameraId);
      if (0 == flag) {
        alert("实况播放成功");
      } else {
        alert("播放实况失败，错误码：" + flag);
      }

    }

    //停止硬解实况
    function DoStopMonitorLive() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var monitorId = document.getElementById("MonitorIDText").value;

      var flag = g_imosActivePlayer.IMOSAX_StopMonitorLive(monitorId);
      if (0 == flag) {
        alert("停止实况成功");
      } else {
        alert("播放实况失败，错误码：" + flag);
      }

    }
    //启动硬解轮切
    function DoStartMonitorSwitch() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var switchID = document.getElementById("SwitchIDText").value;
      var monitorId = document.getElementById("MonitorIDText").value;
      var flag = g_imosActivePlayer.IMOSAX_StartMonitorSwitch(monitorId, switchID);
      if (0 == flag) {
        alert("启动轮切成功");
      } else {
        alert("启动轮切失败，错误码：" + flag);
      }

    }
    //停止硬解轮切
    function DoStopMonitorSwitch() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var monitorId = document.getElementById("MonitorIDText").value;
      var flag = g_imosActivePlayer.IMOSAX_StopMonitorSwitch(monitorId);
      if (0 == flag) {
        alert("停止轮切成功");
      } else {
        alert("停止轮切失败，错误码：" + flag);
      }

    }
    //硬解轮切控制
    function DoAdjustMonitorSwitch() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var monitorId = document.getElementById("MonitorIDText").value;
      var adjustAction = document.getElementById("AdjustAction").value;
      var flag = g_imosActivePlayer.IMOSAX_AdjustMonitorSwitch(monitorId, adjustAction);
      if (0 == flag) {
        alert("轮切控制成功");
      } else {
        alert("轮切控制失败，错误码：" + flag);
      }

    }
    //软解组显示操作

    function DoHandleGroupShow() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }

      if (g_isLogin) {
        alert("未登录，请先登录再使用本功能！");
        return;
      }

      var GroupShowHandleType = document.getElementById("GroupShowHandleType").value;
      var GroupShowCode = document.getElementById("GroupShowCode").value;

      var resStr = g_imosActivePlayer.IMOSAX_HandleGroupShow(GroupShowHandleType, GroupShowCode);

      if (0 == resStr) {
        if (1 == GroupShowHandleType) {
          alert("启动组显示成功！");
        } else if (0 == GroupShowHandleType) {
          alert("停止组显示成功！");
        } else {
          alert("操作码不对！");
        }
      } else {
        if (1 == GroupShowHandleType) {
          alert("启动组显示失败！错误码=" + resStr);
        } else if (0 == GroupShowHandleType) {
          alert("停止组显示失败！错误码=" + resStr);
        } else {
          alert("操作码不对！");
        }
      }

      return;

    }

    //查询组显示中的摄像机信息
    function DoQueryGroupShow() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }

      if (g_isLogin) {
        alert("未登录，请先登录再使用本功能！");
        return;
      }

      var GroupShowCode = document.getElementById("GroupShowCode").value;

      var resStr = g_imosActivePlayer.IMOSAX_QueryCameraInfoGroupShow(GroupShowCode);

      alert(resStr);

      return;
    }
    //启动硬解组显示
    function StartSalvoTV() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }

      if (g_isLogin) {
        alert("未登录，请先登录再使用本功能！");
        return;
      }

      var strSalvoCode = document.getElementById("strSalvoCodeTV").value;
      var retCode = g_imosActivePlayer.IMOSAX_StartGroupShow(strSalvoCode);
      if (0 != retCode) {
        alert("启动组显示失败，错误码：" + retCode);
        return;
      }
      alert("启动组显示成功");
    }

    //停止硬解组显示
    function StopSalvoTV() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }

      if (g_isLogin) {
        alert("未登录，请先登录再使用本功能！");
        return;
      }

      var strSalvoCode = document.getElementById("strSalvoCodeTV").value;
      var retCode = g_imosActivePlayer.IMOSAX_StopGroupShow(strSalvoCode);
      if (0 != retCode) {
        alert("停止组显示失败，错误码：" + retCode);
        return;
      }
      alert("停止组显示成功");
    }
    //组轮巡
    function ProcessGroupsalvo() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }

      if (g_isLogin) {
        alert("未登录，请先登录再使用本功能！");
        return;
      }

      var GroupsalvoCode = document.getElementById("GroupsalvoCode").value;

      var OperateType = document.getElementById("OperateType").value;

      var OperateCode = document.getElementById("OperateCode").value;

      var resStr = g_imosActivePlayer.IMOSAX_ProcessGroupsalvo(GroupsalvoCode, OperateType, OperateCode);

      alert(resStr);

      return;
    }

    //启动实况（独立播放窗格）
    function DoStartPlay2() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var cameraId = document.getElementById("CamIDText").value;
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        //alert("请先选择一个窗格");
        //return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StartNewFrameLive(1, cameraId);
      if (0 == flag) {
        alert("实况播放成功");
      } else {
        alert("播放实况失败，错误码：" + flag);
      }
    }
    //释放实况（独立播放窗格）
    function DoStopPlay2() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }

      var retCode = g_imosActivePlayer.IMOSAX_StopNewFrameLive(1);
      if (0 == retCode) {
        alert("停止实况成功");
      } else {
        alert("停止实况失败，错误码：" + retCode);
      }
    }
    //启动文件
    function DoStartFile() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var cameraId = document.getElementById("FileIDText").value;
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StartLocalReplay(frameNum, cameraId);
      if (0 == flag) {
        alert("播放文件成功");
      } else {
        alert("播放文件失败，错误码：" + flag);
      }
    }

    //释放文件
    function DoStopFile() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var frameNum = g_curFrameNum;
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StopReplay(frameNum);
      if (0 == flag) {
        alert("停止文件成功");
      } else {
        alert("停止文件失败，错误码：" + flag);
      }
    }

    //单步
    function DoStepFile() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var frameNum = g_curFrameNum;
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_OneStepPlay(frameNum);
      if (0 != flag) {
        alert("单步文件失败，错误码：" + flag);
      }
    }

    function DoGetAllCamList() {
      var strXmlQueryCondition = "";
      strXmlQueryCondition = '<?xml version="1.0" ?>' +
        '<data>' +
        '<ItemNum>3</ItemNum>' + //总共有三个查询条件(不限制摄像头子类型即查询所有类型的摄像头包括固定摄像头等)
        '<QueryConditionList count="3">' + //这边的查询条件数量要和ItemNum一样
        '<item>' + // 查询子域
        '<QueryType>257</QueryType> ' +
        '<LogicFlag>0</LogicFlag> ' +
        '<QueryData>1</QueryData> ' +
        '</item>' +
        '<item>' + //查询的资源类型是摄像头
        '<QueryType>256</QueryType>' +
        '<LogicFlag>0</LogicFlag>' +
        '<QueryData>1001</QueryData>' +
        '</item>' +
        '<item>' + // 查询结果按照名称的升序排序
        '<QueryType>1</QueryType> ' +
        '<LogicFlag>6</LogicFlag>' +
        '<QueryData /> ' +
        '</item>' +
        '</QueryConditionList>' +
        '</data>';

      var strXmlQueryPageInfo = '<?xml version="1.0" ?> ' +
        '<data>' +
        '<PageRowNum>100</PageRowNum>' + //最多返回100个记录()
        '<PageFirstRowNumber>0</PageFirstRowNumber>' + //从第0个记录开始返回
        '<QueryCount>1</QueryCount>' + //还需要返回总记录数
        '</data>';

      var retStr = "";
      retStr = g_imosActivePlayer.IMOSAX_QueryOrgResListEx('iccsid', strXmlQueryCondition, strXmlQueryPageInfo);

      var cameraListObj = loadXML(retStr);
      if (!cameraListObj) {
        return;
      }
      var CameraStatus = cameraListObj.documentElement.selectNodes("//result/ResList/item/ResItemV1/ResStatus"); //参见文档xml结构进行解析
      var CameraCode = cameraListObj.documentElement.selectNodes("//result/ResList/item/ResItemV1/ResCode"); //参见文档xml结构进行解析
      var RowNum = cameraListObj.documentElement.selectNodes("//result/RespPageInfo/RowNum");
      var RowNum = RowNum[0].text;
      var intRowNum = parseInt(RowNum);
      for (var i = 0; i < intRowNum; i++) {
        textAllCameraCode.value = textAllCameraCode.value + CameraCode[i].text + "\n";
        if (1 == parseInt(CameraStatus[i].text)) //判断是否在线
        {
          textOnlineCameraCode.value = textOnlineCameraCode.value + CameraCode[i].text + "\n";
        }
      }
      textXML.value = retStr;
    }

    function DoGetAlarmList() {
      var strXmlQueryCondition = "";

      var strXmlQueryPageInfo = '<?xml version="1.0" ?> ' +
        '<data>' +
        '<PageRowNum>10</PageRowNum>' + //最多返回100个记录
        '<PageFirstRowNumber>0</PageFirstRowNumber>' + //从第0个记录开始返回
        '<QueryCount>1</QueryCount>' + //还需要返回总记录数
        '</data>';

      var retStr = "";
      retStr = g_imosActivePlayer.IMOSAX_QueryAlarmList(strXmlQueryCondition, strXmlQueryPageInfo);
      alert(retStr);
    }



    //下载业务
    function DoDownloadQueryRecord() {
      var cameraId = document.getElementById("CamIDText").value;
      var startQueryTime = document.getElementById("DownloadStartTime").value;
      var endQueryTime = document.getElementById("DownloadEndTime").value;
      var retStr = g_imosActivePlayer.IMOSAX_QueryRecord(cameraId, startQueryTime, endQueryTime);
      alert(retStr);
      var recordListObj = loadXML(retStr);
      var RecordObjArray = recordListObj.documentElement.selectNodes("//RESLIST/item");

      var FileListObj = document.all.FileList;
      FileListObj.innerHTML = '';
      for (i = 0; i < RecordObjArray.length; i++) {
        var FileName = RecordObjArray[i].selectSingleNode("FileName").text;
        var StartTime = RecordObjArray[i].selectSingleNode("StartTime").text;
        var EndTime = RecordObjArray[i].selectSingleNode("EndTime").text;
        AddList(FileListObj, StartTime + '~' + EndTime, FileName);
      }

    }

    function DoDownload() {
      var cameraId = document.getElementById("CamIDText").value;
      var FileListObj = document.all.FileList;
      var file_name = FileListObj.value;
      var start_time;
      var stop_time;
      var time_array;
      // 从列表中获取当前选择的文件起止时间
      for (var i = 0; i < FileListObj.options.length; i++) {
        if (FileListObj.options[i].value == FileListObj.value) {
          time_array = FileListObj.options[i].innerText.split("~");
          start_time = time_array[0];
          stop_time = time_array[1];
          DebugAlert(start_time + ":" + stop_time);
          break;
        }
      }
      if ("" == time_array) {
        return;
      }
      gdownloadID = g_imosActivePlayer.IMOSAX_StartDownMediaStream(cameraId, start_time, stop_time);
      alert(gdownloadID);
      document.getElementById("downloadID1").value = gdownloadID;
    }

    //下载停止
    function DoDownloadStop() {

      var downloadId = document.getElementById("downloadID1").value;
      var flag = g_imosActivePlayer.IMOSAX_StopDownMediaStream(downloadId);
      if (0 != flag) {
        alert("停止下载失败，错误码：" + flag);
      } else {
        alert("停止下载成功！")
      }
    }

    //获取下载进度

    function DoGetDownloadPos() {
      var downloadId = document.getElementById("downloadID1").value;
      var flag = g_imosActivePlayer.IMOSAX_GetDownloadPos(downloadId);

      alert(flag);
    }

    //获取下载信息
    function DoGetDownloadInfo() {
      var downloadId = document.getElementById("downloadID1").value;
      var flag = g_imosActivePlayer.IMOSAX_GetDownloadInfo(downloadId);

      alert(flag);
    }

    //回放查询
    function DoQueryRecord() {
      var cameraId = document.getElementById("CamIDText").value;
      var startQueryTime = document.getElementById("StartTimeText").value;
      var endQueryTime = document.getElementById("EndTimeText").value;
      var retStr = g_imosActivePlayer.IMOSAX_QueryRecord(cameraId, startQueryTime, endQueryTime);

      if (retStr != "") {
        alert(retStr);
        var recordListObj = loadXML(retStr);
        var RecordObjArray = recordListObj.documentElement.selectNodes("//RESLIST/item");

        var FileListObj = document.all.FileList;
        FileListObj.innerHTML = '';
        for (i = 0; i < RecordObjArray.length; i++) {
          var FileName = RecordObjArray[i].selectSingleNode("FileName").text;
          var StartTime = RecordObjArray[i].selectSingleNode("StartTime").text;
          var EndTime = RecordObjArray[i].selectSingleNode("EndTime").text;
          AddList(FileListObj, StartTime + '~' + EndTime, FileName);
        }
      } else {
        alert("没有录像！");
      }

    }

    function DoQueryRecord1() {
      var cameraId = document.getElementById("CamIDText").value;
      var startQueryTime = document.getElementById("StartTimeText1").value;
      var endQueryTime = document.getElementById("EndTimeText1").value;
      var retStr = g_imosActivePlayer.IMOSAX_QueryBakRecord(cameraId, startQueryTime, endQueryTime);
      alert(retStr);

      var recordListObj = loadXML(retStr);
      var RecordObjArray = recordListObj.documentElement.selectNodes("//RESLIST/item");

      var FileListObj = document.all.FileList;
      FileListObj.innerHTML = '';
      for (i = 0; i < RecordObjArray.length; i++) {
        var FileName = RecordObjArray[i].selectSingleNode("BakFilePath").text;
        var StartTime = RecordObjArray[i].selectSingleNode("BeginTime").text;
        var EndTime = RecordObjArray[i].selectSingleNode("EndTime").text;
        AddList(FileListObj, StartTime + '~' + EndTime, FileName);
      }

    }

    function DoQueryRecord2() {
      var cameraId = document.getElementById("CamIDText").value;
      var startQueryTime = document.getElementById("StartTimeText2").value;
      var endQueryTime = document.getElementById("EndTimeText2").value;
      var retStr = g_imosActivePlayer.IMOSAX_QuerySlaveRecord(cameraId, startQueryTime, endQueryTime);
      alert(retStr);
      var recordListObj = loadXML(retStr);
      var RecordObjArray = recordListObj.documentElement.selectNodes("//RESLIST/item");

      var FileListObj = document.all.FileList;
      FileListObj.innerHTML = '';
      for (i = 0; i < RecordObjArray.length; i++) {
        var FileName = RecordObjArray[i].selectSingleNode("FileName").text;
        var StartTime = RecordObjArray[i].selectSingleNode("StartTime").text;
        var EndTime = RecordObjArray[i].selectSingleNode("EndTime").text;
        AddList(FileListObj, StartTime + '~' + EndTime, FileName);
      }

    }
    //查询车辆信息
    function QueryTollgateVehicleInfo() {
      var StartTime = document.getElementById("QueryTollgateStartTimeText").value;
      var EndTime = document.getElementById("QueryTollgateEndTimeText").value;
      var TollgateCode = document.getElementById("TollgateCode").value;
      //alert(TollgateCode);
      //alert(StartTime);
      var strXmlQueryCondition = "";
      strXmlQueryCondition = '<?xml version="1.0" ?>' +
        '<data>' +
        '<ItemNum>3</ItemNum>' +
        '<QueryConditionList count="3">' +
        '<item>' + // 查询子域
        '<QueryType>351</QueryType> ' +
        '<LogicFlag>0</LogicFlag> ' +
        '<QueryData>' + TollgateCode + '</QueryData> ' +
        '</item>' +
        '<item>' + // 查询开始时间
        '<QueryType>356</QueryType> ' +
        '<LogicFlag>3</LogicFlag> ' +
        '<QueryData>' + StartTime + '</QueryData> ' +
        '</item>' +
        '<item>' + // 查询结束时间
        '<QueryType>356</QueryType> ' +
        '<LogicFlag>4</LogicFlag> ' +
        '<QueryData>' + EndTime + '</QueryData> ' +
        '</item>' +
        '</QueryConditionList>' +
        '</data>';
      var strXmlQueryPageInfo = '<?xml version="1.0" ?> ' +
        '<data>' +
        '<PageRowNum>10</PageRowNum>' + //最多返回100个记录()
        '<PageFirstRowNumber>0</PageFirstRowNumber>' + //从第0个记录开始返回
        '<QueryCount>1</QueryCount>' + //还需要返回总记录数
        '</data>';
      var retStr = "";
      retStr = g_imosActivePlayer.IMOSAX_QueryVehicleDataList(strXmlQueryCondition, strXmlQueryPageInfo);
      alert(retStr);

    }
    //手动添加录像
    function SetManualBak() {
      var StartTime = document.getElementById("QueryBakStartTimeText").value;
      var EndTime = document.getElementById("QueryBakEndTimeText").value;
      var BakCameraCode = document.getElementById("BakCameraCode").value;
      var BaktaskDesc = document.getElementById("BaktaskDesc").value;
      var retStr = "";
      retStr = g_imosActivePlayer.IMOSAX_SetManualBak(BakCameraCode, BaktaskDesc, StartTime, EndTime);
      alert(retStr);
      var fso, tf;
      fso = new ActiveXObject("Scripting.FileSystemObject"); //获取对象
      tf = fso.CreateTextFile("c:\\testfile.txt", true); //创建一个文件夹
      // 写一行，并且带有新行字符。
      tf.WriteLine(BakCameraCode + " TaskCode is " + retStr);
      tf.Close(); //关闭
    }
    //播放选中文件
    function DelBakTask() {
      var BakTaskCode = document.getElementById("BakTaskCode").value;
      var retStr = "";
      retStr = g_imosActivePlayer.IMOSAX_DelBakTask(BakTaskCode);
      alert(retStr);
    }

    function QueryBakTaskList() {
      var retStr = "";
      var BakCameraName = document.getElementById("BakCameraName").value;
      var strXmlQueryCondition = "";
      strXmlQueryCondition = '<?xml version="1.0" ?>' +
        '<data>' +
        '<ItemNum>1</ItemNum>' +
        '<QueryConditionList count="1">' +
        '<item>' + // 查询子域
        '<QueryType>1</QueryType> ' +
        '<LogicFlag>0</LogicFlag> ' +
        '<QueryData>' + BakCameraName + '</QueryData> ' +
        '</item>' +
        '</QueryConditionList>' +
        '</data>';
      var strXmlQueryPageInfo = '<?xml version="1.0" ?> ' +
        '<data>' +
        '<PageRowNum>10</PageRowNum>' + //最多返回100个记录()
        '<PageFirstRowNumber>0</PageFirstRowNumber>' + //从第0个记录开始返回
        '<QueryCount>1</QueryCount>' + //还需要返回总记录数
        '</data>';
      retStr = g_imosActivePlayer.IMOSAX_QueryBakTaskList(strXmlQueryCondition, strXmlQueryPageInfo);
      alert(retStr);
      var fso, tf;
      fso = new ActiveXObject("Scripting.FileSystemObject"); //获取对象
      tf = fso.CreateTextFile("c:\\xml.txt", true); //创建一个文件夹
      // 写一行，并且带有新行字符。
      tf.WriteLine(retStr);
    }

    function DoPlayRecord() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var cameraId = document.getElementById("CamIDText").value;
      var FileListObj = document.all.FileList;
      var file_name = FileListObj.value;
      var start_time;
      var stop_time;
      var time_array;
      // 从列表中获取当前选择的文件起止时间
      for (var i = 0; i < FileListObj.options.length; i++) {
        if (FileListObj.options[i].value == FileListObj.value) {
          time_array = FileListObj.options[i].innerText.split("~");
          start_time = time_array[0];
          stop_time = time_array[1];
          DebugAlert(start_time + ":" + stop_time);
          break;
        }
      }
      if ("" == time_array) {
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StartVodReplay(frameNum, cameraId, start_time, stop_time);
      if (0 != flag) {
        alert("回放失败，错误码：" + flag);
      }
    }

    function DoPlayRecord2() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var cameraId = document.getElementById("CamIDText").value;
      var FileListObj = document.all.FileList;
      var file_name = FileListObj.value;
      var start_time;
      var stop_time;
      var time_array;
      // 从列表中获取当前选择的文件起止时间
      for (var i = 0; i < FileListObj.options.length; i++) {
        if (FileListObj.options[i].value == FileListObj.value) {
          time_array = FileListObj.options[i].innerText.split("~");
          start_time = time_array[0];
          stop_time = time_array[1];
          DebugAlert(start_time + ":" + stop_time);
          break;
        }
      }
      if ("" == time_array) {
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StartSlaveVodReplay(frameNum, cameraId, start_time, stop_time);
      if (0 != flag) {
        alert("回放失败，错误码：" + flag);
      }
    }

    function DoPlayRecord1() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var cameraId = document.getElementById("CamIDText").value;
      var FileListObj = document.all.FileList;
      var file_name = FileListObj.value;
      var start_time;
      var stop_time;
      var time_array;
      // 从列表中获取当前选择的文件起止时间
      for (var i = 0; i < FileListObj.options.length; i++) {
        if (FileListObj.options[i].value == FileListObj.value) {
          time_array = FileListObj.options[i].innerText.split("~");
          start_time = time_array[0];
          stop_time = time_array[1];
          DebugAlert(start_time + ":" + stop_time);
          break;
        }
      }
      if ("" == time_array) {
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StartBakVodReplay(frameNum, cameraId, start_time, stop_time);
      if (0 != flag) {
        alert("回放失败，错误码：" + flag);
      }
    }
    //停止录像回放

    function DoStopPlayRecord() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StopReplay(frameNum);
      if (0 != flag) {
        alert("关闭回放失败，错误码：" + flag);
      }

    }

    //暂停回放
    function DoPauseReplay() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_PauseReplay(frameNum);
      if (0 != flag) {
        alert("暂停回放失败，错误码：" + flag);
      } else {
        alert("暂停回放成功！");
      }

    }
    //继续回放
    function DoResumeReplay() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_ResumeReplay(frameNum);
      if (0 != flag) {
        alert("继续回放失败，错误码：" + flag);
      } else {
        alert("继续回放成功！");
      }
    }

    function DoBakDownload() {

      var cameraId = document.getElementById("CamIDText").value;
      var FileListObj = document.all.FileList;
      var file_name = FileListObj.value;
      var start_time;
      var stop_time;
      var time_array;
      // 从列表中获取当前选择的文件起止时间
      for (var i = 0; i < FileListObj.options.length; i++) {
        if (FileListObj.options[i].value == FileListObj.value) {
          time_array = FileListObj.options[i].innerText.split("~");
          start_time = time_array[0];
          stop_time = time_array[1];
          DebugAlert(start_time + ":" + stop_time);
          break;
        }
      }
      if ("" == time_array) {
        return;
      }
      gdownloadID = g_imosActivePlayer.IMOSAX_StartDownBakMediaStream(cameraId, start_time, stop_time);
      alert(gdownloadID);
      document.getElementById("downloadID").value = gdownloadID;

    }

    function DoSlaveDownload() {

      var cameraId = document.getElementById("CamIDText").value;
      var FileListObj = document.all.FileList;
      var file_name = FileListObj.value;
      var start_time;
      var stop_time;
      var time_array;
      // 从列表中获取当前选择的文件起止时间
      for (var i = 0; i < FileListObj.options.length; i++) {
        if (FileListObj.options[i].value == FileListObj.value) {
          time_array = FileListObj.options[i].innerText.split("~");
          start_time = time_array[0];
          stop_time = time_array[1];
          DebugAlert(start_time + ":" + stop_time);
          break;
        }
      }
      if ("" == time_array) {
        return;
      }
      gdownloadID2 = g_imosActivePlayer.IMOSAX_StartDownSlaveMediaStream(cameraId, start_time, stop_time);
      alert(gdownloadID2);
      document.getElementById("downloadID2").value = gdownloadID2;

    }

    function DoBakDownloadStop() {

      var downloadId = document.getElementById("downloadID").value;
      var flag = g_imosActivePlayer.IMOSAX_StopDownMediaStream(downloadId);
      alert(flag);
    }

    function DoSlaveDownloadStop() {

      var downloadId = document.getElementById("downloadID2").value;
      var flag = g_imosActivePlayer.IMOSAX_StopDownMediaStream(downloadId);
      alert(flag);
    }
    //获取播放进度

    function GetReplayPos() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var posTime = g_imosActivePlayer.IMOSAX_GetReplayPos(frameNum);
      alert(posTime);
    }



    //回放控制

    function ReplayControl(cmd) {

    }


    //回放跳转

    function SetPos() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var pos = document.all.PosText.value; //时间格式为：yyyy-mm-dd hh:mm:ss
      var flag = g_imosActivePlayer.IMOSAX_DragPlay(frameNum, pos)
      if (0 != flag) {
        alert("拖动回放失败，错误码：" + flag);
      }

    }


    //设置播放速度

    function SetPlaySpeed(speed) {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_SetPlaySpeed(frameNum, speed);
      if (0 != flag) {
        alert("设置回放速度失败，错误码：" + flag);
      }
    }
    //查询回放录像url信息
    function DoQueryRecordFileUrl() {
      var cameraId = document.getElementById("CamIDText").value;
      var FileListObj = document.all.FileList;
      var file_name = FileListObj.value;
      var start_time;
      var stop_time;
      var time_array;
      // 从列表中获取当前选择的文件起止时间
      for (var i = 0; i < FileListObj.options.length; i++) {
        if (FileListObj.options[i].value == FileListObj.value) {
          time_array = FileListObj.options[i].innerText.split("~");
          start_time = time_array[0];
          stop_time = time_array[1];
          DebugAlert(start_time + ":" + stop_time);
          break;
        }
      }
      if ("" == time_array) {
        return;
      }
      var url = g_imosActivePlayer.IMOSAX_QueryRecordFileUrl(cameraId, file_name, start_time, stop_time);
      alert(url);
    }
    //云检索业务
    //云检索录像
    function DoCloudQueryRecord() {
      var cameraId = document.getElementById("CamIDText").value;
      var startQueryTime = document.getElementById("CloudStartTime").value;
      var endQueryTime = document.getElementById("CloudEndTime").value;
      var retStr = g_imosActivePlayer.IMOSAX_UnitedRecordRetrieval(cameraId, startQueryTime, endQueryTime);
      alert(retStr);
      var recordListObj = loadXML(retStr);
      var RecordObjArray = recordListObj.documentElement.selectNodes("//RESLIST/item");

      var FileListObj = document.all.FileList;
      FileListObj.innerHTML = '';
      for (i = 0; i < RecordObjArray.length; i++) {
        var FileName = RecordObjArray[i].selectSingleNode("FileName").text;
        var StartTime = RecordObjArray[i].selectSingleNode("StartTime").text;
        var EndTime = RecordObjArray[i].selectSingleNode("EndTime").text;
        AddList(FileListObj, StartTime + '~' + EndTime, FileName);
      }
    }
    //播放云检索录像
    function DoPlayCloudRecord() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var cameraId = document.getElementById("CamIDText").value;
      var FileListObj = document.all.FileList;
      var file_name = FileListObj.value;
      var start_time;
      var stop_time;
      var time_array;
      // 从列表中获取当前选择的文件起止时间
      for (var i = 0; i < FileListObj.options.length; i++) {
        if (FileListObj.options[i].value == FileListObj.value) {
          time_array = FileListObj.options[i].innerText.split("~");
          start_time = time_array[0];
          stop_time = time_array[1];
          DebugAlert(start_time + ":" + stop_time);
          break;
        }
      }
      if ("" == time_array) {
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StartVodReplayII(frameNum, cameraId, start_time, stop_time);
      if (0 != flag) {
        alert("播放失败，错误码：" + flag);
      }
    }
    //拖动播放（云检索录像）

    function SetCloudPos() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var pos = document.all.CloudPosText.value; //时间格式为：yyyy-mm-dd hh:mm:ss
      var flag = g_imosActivePlayer.IMOSAX_DragPlayII(frameNum, pos)
      if (0 != flag) {
        alert("拖动回放云检索失败，错误码：" + flag);
      }
    }

    //云检索录像下载
    function DoCloudDownload() {
      var cameraId = document.getElementById("CamIDText").value;
      var FileListObj = document.all.FileList;
      var file_name = FileListObj.value;
      var start_time;
      var stop_time;
      var time_array;
      // 从列表中获取当前选择的文件起止时间
      for (var i = 0; i < FileListObj.options.length; i++) {
        if (FileListObj.options[i].value == FileListObj.value) {
          time_array = FileListObj.options[i].innerText.split("~");
          start_time = time_array[0];
          stop_time = time_array[1];
          DebugAlert(start_time + ":" + stop_time);
          break;
        }
      }
      if ("" == time_array) {
        return;
      }
      gdownloadID = g_imosActivePlayer.IMOSAX_StartDownMediaStreamII(cameraId, start_time, stop_time);
      alert(gdownloadID);
      document.getElementById("CloudDownloadID").value = gdownloadID;

    }
    //云检索录像下载停止
    function DoCloudDownloadStop() {
      var downloadId = document.getElementById("CloudDownloadID").value;
      var flag = g_imosActivePlayer.IMOSAX_StopDownMediaStreamII(downloadId);
      if (0 != flag) {
        alert("停止下载失败，错误码：" + flag);
      } else {
        alert("停止下载成功！")
      }

    }
    //获取云检索录像下载信息
    function DoGetCloudDownloadInfo() {

      var downloadId = document.getElementById("CloudDownloadID").value;
      var flag = g_imosActivePlayer.IMOSAX_GetDownloadInfoII(downloadId);
      alert(flag);


    }

    //获取云检索录像下载进度
    function DoGetCloudDownloadPos() {

      var downloadId = document.getElementById("CloudDownloadID").value;
      var flag = g_imosActivePlayer.IMOSAX_GetDownloadPosII(downloadId);

      alert(flag);

    }

    //语音业务
    //启动语音对讲
    function DoStartVoiceTalk() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var cameraId = document.getElementById("CamIDText").value;

      var flag = g_imosActivePlayer.IMOSAX_StartVoiceTalk(cameraId);
      if (0 == flag) {
        alert("启动语音对讲成功");
      } else {
        alert("启动语音对讲失败，错误码：" + flag);
      }
    }

    //停止语音对讲
    function DoStopVOiceTalk() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }

      var flag = g_imosActivePlayer.IMOSAX_StopVoiceTalk();

      if (0 == flag) {
        alert("停止语音对讲成功");
      } else {
        alert("停止语音对讲失败，错误码：" + flag);
      }

    }

    function DoStartVoiceBroadcast() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }

      var vocBrdUnit = document.getElementById("VoiceParam").value;
      var vocBrdCode = "";

      var flag = g_imosActivePlayer.IMOSAX_StartVoiceBroadcast(vocBrdCode, vocBrdUnit);
      alert(flag);



    }

    function DoStopVoiceBroadcast() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }

      var vocBrdUnit = document.getElementById("VoiceParam").value;
      var vocBrdCode = "";

      var flag = g_imosActivePlayer.IMOSAX_StopVoiceBroadcast(vocBrdCode, vocBrdUnit);

      alert(flag);

    }

    //音量调节
    function DoStopSound() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StopSound(frameNum);
      if (0 != flag) {
        alert("关闭声音失败，错误码：" + flag);
      } else {
        alert("关闭声音成功！")
      }

    }

    function DoPlaySound() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_PlaySound(frameNum);
      if (0 != flag) {
        alert("开启声音失败，错误码：" + flag);
      } else {
        alert("开启声音成功！")
      }
    }

    function DoAdjustAllWaveAudio() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }
      var AudioText = document.getElementById("AudioText").value;

      var flag = g_imosActivePlayer.IMOSAX_AdjustAllWaveAudio(AudioText);
      if (0 == flag) {
        alert("调节音量成功");
      } else {
        alert("调节音量失败，错误码：" + flag);
      }

    }

    function DoGetAllWaveAudio() {
      if (!g_imosActivePlayer) {
        alert("未安装控件，请先安装后再使用本页面");
        return;
      }

      var waveAudio = g_imosActivePlayer.IMOSAX_GetAllWaveAudio();

      alert(waveAudio);


    }


    //抓拍

    //抓拍图片将保存在指定路径下, 以当天日期为名称的文件夹内

    function DoSnatch() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_SnatchOnce(frameNum);
      if (0 != flag) {
        alert("抓拍失败，错误码：" + flag);
      }

    }

    function DoStartSnatchSeries() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StartSnatchSeries(frameNum);
      if (0 != flag) {
        alert("连续抓拍失败，错误码：" + flag);
      } else {
        alert("连续抓拍成功！")
      }

    }

    function DoStopSnatchSeries() {
      var frameNum = g_curFrameNum;
      frameNum = parseInt(frameNum, 10);
      if (isNaN(frameNum) || frameNum < 1 || frameNum > 25) {
        alert("请先选择一个窗格");
        return;
      }
      var flag = g_imosActivePlayer.IMOSAX_StopSnatchSeries(frameNum);
      if (0 != flag) {
        alert("停止连续抓拍失败，错误码：" + flag);
      } else {
        alert("停止连续抓拍成功！")
      }
    }

    //================>功能函数---end

    //================>事件处理函数event---start

    /**
     * 窗格单击事件的处理函数
     */
    function dealEventClickFrame(ulFrameNum, pcFrameInfo) {
      //当前窗格
      g_curFrameNum = ulFrameNum;
      pcFrameInfo = pcFrameInfo.replaceAll("\"", "\'");
      var tmpXmlDoc = loadXML(pcFrameInfo);
      if (!tmpXmlDoc) {
        return;
      }
      //将需要的数据从xml中获取，方便后续使用
      var cameraID = tmpXmlDoc.selectNodes("//FrameInfo//CameraCode")[0];
      if (cameraID) {
        document.getElementById("CamIDText").value = cameraID.text;
        return;
      } else {
        document.getElementById("CamIDText").value = "未启动";
      }

    }

    //================>事件处理函数event---end
  </script>

</head>

<body onload="InitPage()" onbeforeunload="DoLogout()" style="font-size:10pt">
  <b>[基本参数] </b> 用户名:
  <input type=text id="UserNameText" value='test201' size=15></text>&nbsp;&nbsp;&nbsp; 密码:
  <input type=password id="PassWordText" value='123456_abc' size=15></text>&nbsp;&nbsp;&nbsp; 服务器IP:
  <input type=text id="ServerIPText" value='10.10.10.1' size=15></text>&nbsp;&nbsp;&nbsp;
  <hr>
  <b>[使用流程] </b>
  <input type=button onclick="DoLogin()" value="登录"></input>-------> 业务操作------>
  <input type=button onclick="DoLogout()" value="退出登录"></input>
  <input type=button onclick="DoGetAlarmList()" value="查询告警"></input>
  <hr>
  <b>[登录状态] </b>
  <span id="loginSt">系统还未登录！</span>
  <hr>
  <input type=b utton onclick="DoGetAllCamList()" value="查询资源接口演示（查询所有摄像机）"></input>
  <br/>
  <b>[所有相机ID]</b><textarea name="textAllCameraCode" cols="20" rows="5" id="show" wrap="physical"></textarea>
  <b>[在线相机ID]</b><textarea name="textOnlineCameraCode" cols="20" rows="5" id="show" wrap="physical"></textarea>
  <b>[XML信息]</b><textarea name="textXML" cols="20" rows="5" id="show" wrap="physical"></textarea>
  <hr>
  <b>[参数设置] </b> 摄像机ID:
  <input type=text id="CamIDText" value='ec1501-ihf_1'>
  </text>
  &nbsp;&nbsp;&nbsp;&nbsp; 监视器ID:
  <input type=text id="MonitorIDText" value='sdc001'>
  </text>
  &nbsp;&nbsp;&nbsp;&nbsp; 轮切ID:
  <input type="text" id="SwitchIDText" value='1652200676693901313' />
  </text>
  &nbsp;&nbsp;&nbsp;&nbsp; 轮切控制类型:
  <input type="text" id="AdjustAction" value='1' size=15>
  </text>
  &nbsp;&nbsp;&nbsp;&nbsp; 句柄类型:
  <input type="text" id="FrameHWnd" value='1' size=15>
  </text>
  <br> &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
  <font color="red">轮切控制（0：暂停，1：恢复，2：向前调整，3：向后调整）</font>
  <p><b>[软解业务] </b>
    <input type=button onclick="DoStartPlay()" value="启动播放">
    </input>
    &nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStopPlay()" value="停止播放">
    </input>
    &nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStartSwitch()" value="启动轮切">
    </input>
    &nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStopSwitch()" value="停止轮切">
    </input>
    &nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoAdjustFrameSwitch()" value="轮切控制">
    </input>
    &nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoSetPlayWnd()" value="绑定窗格通道">
    </input>
    &nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoSetAlarmInfo()" value="设置告警">
    </input>
  </p>
  <hr />
  <p><b>[硬解业务] </b>
    <input type=button onclick="DoStartMonitorLive()" value="启动播放">
    </input>
    &nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStopMonitorLive()" value="停止播放">
    </input>
    &nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStartMonitorSwitch()" value="启动轮切">
    </input>
    &nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStopMonitorSwitch()" value="停止轮切">
    </input>
    &nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoAdjustMonitorSwitch()" value="轮切控制">
    </input>
  </p>
  <hr />
  <p><b>[软解组显示] </b> 组显示操作方式：
    <input type="text" id="GroupShowHandleType" value="" />
    <font color="red">(1：启动，0：停止）</font>
    组显示编码：<input type="text" id="GroupShowCode" value="" />
    <input type="button" onclick="DoHandleGroupShow()" value="组显示操作" />
    <input type="button" onclick="DoQueryGroupShow()" value="查询组显示摄像机信息" />
    <hr>
    <b>[硬解组显示]</b> 组显示编码：
    <input type="text" id="strSalvoCodeTV" value="" />
    <input type="button" onclick="StartSalvoTV()" value="启动"></input>
    <input type="button" onclick="StopSalvoTV()" value="停止"></input>
    <hr>
    <b>[硬解组轮巡]</b> 组轮巡编码：
    <input type="text" id="GroupsalvoCode" value="" /> 操作类型：
    <input type="text" id="OperateType" value="" /> 操作原因码：
    <input type="text" id="OperateCode" value="0" />
    <input type="button" onclick="ProcessGroupsalvo()" value="组轮巡操作">
    <br>
    <font color="red">操作类型（0：停止，1：启动，2：向前调整，3：向后调整，4：暂停）</font>
    <hr>
    <p><b>[本地文件] </b> 文件名：
      <input name="" type="text" id="FileIDText" value="c:\" size="128" />
    </p>
    <p>
      </text>
      &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
      <input type="button" onclick="DoStartFile()" value="播放文件" /> &nbsp;&nbsp;&nbsp;
      <input type="button" onclick="DoStopFile()" value="停止播放" /> &nbsp;&nbsp;&nbsp;
      <input type="button" onclick="DoStepFile()" value="单帧播放" />
    </p>
    <hr>
    <b>[语音业务] </b>
    <input type=button onclick="DoStartVoiceTalk()" value="启动语音对讲"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStopVOiceTalk()" value="停止语音对讲"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStartVoiceBroadcast()" value="开启语音广播"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStopVoiceBroadcast()" value="停止语音广播"></input>&nbsp;&nbsp;&nbsp;
    <hr> 广播列表信息：
    <input type=text id="VoiceParam" value='<?xml version="1.0"?><INFO count="1"><item><CameraCode>EC2004-139_2</CameraCode><CameraName></CameraName><State></State></item></INFO>' size=256></text>&nbsp;&nbsp;&nbsp;
    <hr>
    <b>[音量调节] </b>
    <input type=button onclick="DoPlaySound()" value="开启声音"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStopSound()" value="关闭声音"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoGetAllWaveAudio()" value="获取所有通道音量"></input>&nbsp;&nbsp;&nbsp; 音量值：
    <input type=text id="AudioText" value="128">
    </text>
    &nbsp;&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoAdjustAllWaveAudio()" value="调节所有通道音量"></input>&nbsp;&nbsp;&nbsp;
    <hr>
    <b>[抓拍业务] </b>
    <input type=button onclick="DoSnatch()" value="抓拍"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStartSnatchSeries()" value="连续抓拍"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStopSnatchSeries()" value="停止连续抓拍"></input>&nbsp;&nbsp;&nbsp;
    <hr>
    <b>[回放业务] </b> 起始时间:
    <input type=text id="StartTimeText" size=24 value="2013-11-26 00:00:00"></text>&nbsp;&nbsp;&nbsp; 结束时间:
    <input type=text id="EndTimeText" size=24 value="2015-11-26 23:59:59"></text>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoQueryRecord()" value="查询"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoPlayRecord()" value="播放选中文件"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStopPlayRecord()" value="停止播放"></input>
    <input type=button onclick="DoPauseReplay()" value="暂停回放"></input>
    <input type=button onclick="DoResumeReplay()" value="继续回放"></input>
    <hr>
    <input type=button onclick="GetReplayPos()" value="获取进度"></input>&nbsp;&nbsp;&nbsp; 设置进度[单位为秒]: <input type=text id="PosText"></text>
    <input type=button onclick="SetPos()" value="拖动播放"></input>&nbsp;&nbsp;&nbsp; 播放速度:
    <select id="PlaySpeed" onchange="SetPlaySpeed(this.value)">
    <option value=0>16倍速后退播放</option>
    <option value=1>8倍速后退播放</option>
    <option value=2>4倍速后退播放</option>
    <option value=3>2倍速后退播放</option>
    <option value=4>正常速度后退播放</option>
    <option value=7>1/4倍速播放</option>
    <option value=8>1/2倍速播放</option>
    <option value=9 selected>正常速度前进播放</option>
    <option value=10>2倍速前进播放</option>
    <option value=11>4倍速前进播放</option>
    <option value=12>8倍速前进播放</option>
    <option value=13>16倍速前进播放</option>
    </select>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoQueryRecordFileUrl()" value="查询url信息"></input>&nbsp;&nbsp;&nbsp;
    <hr>
    <b>[云检索业务] </b> 起始时间:
    <input type=text id="CloudStartTime" size=24 value="2013-11-26 00:00:00"></text>&nbsp;&nbsp;&nbsp; 结束时间:
    <input type=text id="CloudEndTime" size=24 value="2015-11-26 23:59:59"></text>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoCloudQueryRecord()" value="查询"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoPlayCloudRecord()" value="播放选中文件"></input>&nbsp;&nbsp;&nbsp; 设置进度[单位为秒]: <input type=text id="CloudPosText"></text>
    <input type=button onclick="SetCloudPos()" value="拖动播放"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStopPlayRecord()" value="停止播放"></input>
    <br>
    <input type=button onclick="DoCloudDownload()" value="下载"></input>
    下载编码:<input type=text id="CloudDownloadID" value="1"></text>
    <input type=button onclick="DoCloudDownloadStop()" value="下载停止"></input>
    <input type=button onclick="DoGetCloudDownloadPos()" value="获取下载进度"></input>
    <input type=button onclick="DoGetCloudDownloadInfo()" value="获取下载信息"></input>
    <hr>
    <b>[下载业务] </b> 起始时间:
    <input type=text id="DownloadStartTime" size=24 value="2013-11-26 00:00:00"></text>&nbsp;&nbsp;&nbsp; 结束时间:
    <input type=text id="DownloadEndTime" size=24 value="2015-11-26 23:59:59"></text>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoDownloadQueryRecord()" value="查询"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoPlayRecord()" value="播放选中文件"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStopPlayRecord()" value="停止播放"></input>
    <br>
    <input type=button onclick="DoDownload()" value="下载"></input>
    下载编码:<input type=text id="downloadID1" value="1"></text>
    <input type=button onclick="DoDownloadStop()" value="下载停止"></input>
    <input type=button onclick="DoGetDownloadPos()" value="获取下载进度"></input>
    <input type=button onclick="DoGetDownloadInfo()" value="获取下载信息"></input>
    <hr>
    <b>[备份业务] </b> 起始时间:
    <input type=text id="StartTimeText1" size=24 value="2013-11-26 00:00:00"></text>&nbsp;&nbsp;&nbsp; 结束时间:
    <input type=text id="EndTimeText1" size=24 value="2015-11-26 23:59:59"></text>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoQueryRecord1()" value="查询"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoPlayRecord1()" value="播放选中文件"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStopPlayRecord()" value="停止播放"></input>
    <br>
    <input type=button onclick="DoBakDownload()" value="备份下载"></input>
    下载编码:<input type=text id="downloadID" value="1"></text>
    <input type=button onclick="DoBakDownloadStop()" value="备份下载停止"></input>
    <hr>
    <b>[备用存储] </b> 起始时间:
    <input type=text id="StartTimeText2" size=24 value="2013-11-27 00:00:00"></text>&nbsp;&nbsp;&nbsp; 结束时间:
    <input type=text id="EndTimeText2" size=24 value="2015-11-27 23:59:59"></text>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoQueryRecord2()" value="查询"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoPlayRecord2()" value="播放选中文件"></input>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DoStopPlayRecord()" value="停止播放"></input>
    <br>
    <input type=button onclick="DoSlaveDownload()" value="备用存储下载"></input>
    下载编码:<input type=text id="downloadID2" value="1"></text>
    <input type=button onclick="DoSlaveDownloadStop()" value="备用下载停止"></input>
    <hr>
    <b>[卡口信息查询] </b>
    <br> 卡口编号:
    <input type=text id="TollgateCode" size=24 value="f001"></text>&nbsp;&nbsp;&nbsp; 起始时间:
    <input type=text id="QueryTollgateStartTimeText" size=24 value="2016-09-24 00:00:00"></text>&nbsp;&nbsp;&nbsp; 结束时间:
    <input type=text id="QueryTollgateEndTimeText" size=24 value="2016-09-24 23:59:59"></text>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="QueryTollgateVehicleInfo()" value="查询车辆信息"></input>&nbsp;&nbsp;&nbsp;
    <hr>
    <b>[录像备份] </b>
    <br> 摄像机编号:
    <input type=text id="BakCameraCode" size=24 value="IPC_GB_131_5421E-YCY"></text>&nbsp;&nbsp;&nbsp; 备份任务名称:
    <input type=text id="BaktaskDesc" size=24 value="中文测试"></text>&nbsp;&nbsp;&nbsp;
    <br> &nbsp;起始时间:
    <input type=text id="QueryBakStartTimeText" size=24 value="2016-10-20 10:23:12"></text>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp 结束时间:
    <input type=text id="QueryBakEndTimeText" size=24 value="2016-10-20 10:28:51"></text>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="SetManualBak()" value="备份录像"></input>&nbsp;&nbsp;&nbsp;
    <br> 备份任务编码:
    <input type=text id="BakTaskCode" size=24 value=""></text>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="DelBakTask()" value="删除备份任务"></input>&nbsp;&nbsp;&nbsp;
    <br> 备份相机名称:
    <input type=text id="BakCameraName" size=24 value="onvif_223"></text>&nbsp;&nbsp;&nbsp;
    <input type=button onclick="QueryBakTaskList()" value="查询备份任务"></input>&nbsp;&nbsp;&nbsp;
    <hr>
    <table width=940>
      <!-- 播放控件  begin -->
      <tr>
        <td>
          <object classid="clsid:067A4418-EBAC-4394-BFBE-8C533BA6503A" id="h3c_IMOS_ActiveX" events="true" height="480" width="640">
    </object>
          <!-- 播放控件  end -->
          <td width=200>
            <select id="FileList" size="30" style="width:300px">
    </select>
    </table>
</body>

</html>
<!--ActiveX控件事件, 初始化完成后会触发, 告知界面当前的播放器ID-->
<script type="text/javascript" for="h3c_IMOS_ActiveX" event="eventClickFrame(ulFrameNum,  pcFrameInfo)">
  if (typeof dealEventClickFrame == "function") {
    dealEventClickFrame(ulFrameNum, pcFrameInfo);
  }
</script>
<script type="text/javascript" for="h3c_IMOS_ActiveX" event="eventVehicleInfo(strParams)">
  //    alert(strParams);
</script>